apiVersion: skaffold/v4beta8
kind: Config
metadata:
  name: skaffold-example
build:
  tagPolicy:
    inputDigest: {}
  artifacts:
    - image: nodejs-app
      docker:
        dockerfile: Dockerfile
  local:
    useDockerCLI: false
    useBuildkit: false
test:
  - image: nodejs-app
    structureTests:
      - './structure-test/*'
deploy:
  helm:
    releases:
      - name: nodejs-app
        chartPath: helm/nodejs-app
        setValueTemplates:
          image.repository: "{{.IMAGE_REPO_nodejs-app}}"
          image.tag: "{{.IMAGE_DIGEST_nodejs-app}}"
        valuesFiles:
          - helm/nodejs-app/values-local.yaml
manifests:
  helm:
    releases:
      - name: nodejs-app
        chartPath: helm/nodejs-app
        valuesFiles:
          - helm/nodejs-app/values-local.yaml
profiles:
  - name: dev
    build:
      tagPolicy:
        inputDigest: {}
      artifacts:
        - image: gcr.io/flyr-gcr/nodejs-app
          docker:
            dockerfile: Dockerfile
      local:
        useDockerCLI: false
        useBuildkit: false
    test:
      - image: gcr.io/flyr-gcr/nodejs-app
        structureTests:
          - './structure-test/*'
    deploy:
      helm:
        releases:
          - name: nodejs-app
            chartPath: helm/nodejs-app
            setValueTemplates:
              image.repository: "{{.IMAGE_REPO_nodejs-app}}"
              image.tag: "{{.IMAGE_DIGEST_nodejs-app}}"
            valuesFiles:
              - helm/nodejs-app/values-dev.yaml
    manifests:
      helm:
        releases:
          - name: nodejs-app
            chartPath: helm/nodejs-app
            valuesFiles:
              - helm/nodejs-app/values-dev.yaml
